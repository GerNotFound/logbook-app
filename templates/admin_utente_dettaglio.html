{% extends 'layout.html' %}
{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-2">ADMIN - GESTIONE UTENTE</h1>
        <h3 class="text-muted mb-4">{{ user.username }}</h3>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}{% for category, message in messages %}<div class="alert alert-{{ category }}">{{ message }}</div>{% endfor %}{% endif %}
        {% endwith %}
    </div>
</div>

<div class="mb-4 p-3 border rounded">
    <h5>Cambia Password</h5>
    <form method="POST" action="{{ url_for('admin.admin_utente_dettaglio', user_id=user.id) }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="action" value="change_password">
        <div class="password-wrapper">
            <input type="password" name="new_password" class="form-control" placeholder="Nuova password" required style="margin-bottom: 0;">
            <i class="bi bi-eye-fill password-toggle-icon"></i>
        </div>
        <button type="submit" class="btn btn-custom w-100 mt-2">IMPOSTA NUOVA PASSWORD</button>
    </form>
</div>

<div class="row">
    <div class="col-12">
        <a href="{{ url_for('admin.admin_utente_schede', user_id=user.id) }}" class="btn btn-custom w-100 d-block">GESTISCI SCHEDE</a>
        <a href="{{ url_for('admin.admin_utente_alimenti', user_id=user.id) }}" class="btn btn-custom w-100 d-block">GESTISCI ALIMENTI</a>
        <a href="{{ url_for('admin.admin_utente_diario_palestra', user_id=user.id) }}" class="btn btn-custom w-100 d-block">VEDI DIARIO PALESTRA</a>
        <a href="{{ url_for('admin.admin_utente_diario_corsa', user_id=user.id) }}" class="btn btn-custom w-100 d-block">VEDI DIARIO CORSA</a>
        <form method="POST" action="{{ url_for('admin.admin_utente_export', user_id=user.id) }}" class="mt-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-outline-light w-100">ESPORTA I DATI</button>
        </form>
    </div>
</div>

<div class="my-4 p-3 border rounded">
    <h5>Elimina Utente</h5>
    <form method="POST" action="{{ url_for('admin.admin_utente_dettaglio', user_id=user.id) }}" data-confirm="Sei assolutamente sicuro di voler eliminare questo utente e tutti i suoi dati? Questa azione è irreversibile.">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="action" value="delete_account">
        <p class="text-muted small">L'eliminazione dell'utente cancellerà permanentemente il suo profilo, le immagini, le misurazioni, i diari alimentari e tutti gli allenamenti registrati.</p>
        <button type="submit" class="btn btn-custom w-100">ELIMINA UTENTE DEFINITIVAMENTE</button>
    </form>
</div>

<div class="sticky-bottom-nav">
    <a href="{{ url_for('admin.admin_utenti') }}" class="btn btn-custom full-width-btn">INDIETRO</a>
</div>
{% endblock %}