{% extends 'layout.html' %}
{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">LOGBOOK - NOTE</h1>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}{% for category, message in messages %}<div class="alert alert-{{ category }}">{{ message }}</div>{% endfor %}{% endif %}
        {% endwith %}
    </div>
</div>

<!-- MODIFICA QUI: Rimosso il box e la descrizione -->
<h5 class="mt-4">Note Private</h5>
<form id="personal-note-form" method="POST" action="{{ url_for('main.note') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="action" value="save_personal">
    <textarea name="personal_note" class="form-control" rows="8" placeholder="Scrivi qui le tue note personali...">{{ note.content or '' }}</textarea>
    <button type="submit" class="btn btn-custom w-100 mt-2">SALVA NOTA PRIVATA</button>
</form>

<!-- MODIFICA QUI: Aggiunta linea orizzontale -->
<hr class="my-4">

<!-- MODIFICA QUI: Rimosso il box e la descrizione -->
<h5>Note per l'Admin</h5>
<form id="shared-note-form" method="POST" action="{{ url_for('main.note') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="action" value="save_shared">
    <!-- MODIFICA QUI: Cambiato il placeholder -->
    <textarea name="shared_note" class="form-control" rows="8" placeholder="L'Admin puÃ² leggere queste note">{{ note.content_shared or '' }}</textarea>
    <button type="submit" class="btn btn-custom w-100 mt-2">SALVA NOTA PER L'ADMIN</button>
</form>

<div class="sticky-bottom-nav">
    <a href="{{ url_for('main.home') }}" class="btn btn-custom full-width-btn">INDIETRO</a>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ csp_nonce() }}">
    const DRAFT_KEY_NOTES_PERSONAL = `notes_draft_personal_{{ session['user_id'] }}`;
    const personalNoteForm = document.getElementById('personal-note-form');
    const personalNoteTextarea = personalNoteForm.querySelector('textarea');
    function savePersonalNoteDraft() { localStorage.setItem(DRAFT_KEY_NOTES_PERSONAL, personalNoteTextarea.value); }
    function loadPersonalNoteDraft() {
        const draft = localStorage.getItem(DRAFT_KEY_NOTES_PERSONAL);
        if (draft) { personalNoteTextarea.value = draft; }
    }
    personalNoteTextarea.addEventListener('input', savePersonalNoteDraft);
    personalNoteForm.addEventListener('submit', () => localStorage.removeItem(DRAFT_KEY_NOTES_PERSONAL));
    document.addEventListener('DOMContentLoaded', loadPersonalNoteDraft);

    const DRAFT_KEY_NOTES_SHARED = `notes_draft_shared_{{ session['user_id'] }}`;
    const sharedNoteForm = document.getElementById('shared-note-form');
    const sharedNoteTextarea = sharedNoteForm.querySelector('textarea');
    function saveSharedNoteDraft() { localStorage.setItem(DRAFT_KEY_NOTES_SHARED, sharedNoteTextarea.value); }
    function loadSharedNoteDraft() {
        const draft = localStorage.getItem(DRAFT_KEY_NOTES_SHARED);
        if (draft) { sharedNoteTextarea.value = draft; }
    }
    sharedNoteTextarea.addEventListener('input', saveSharedNoteDraft);
    sharedNoteForm.addEventListener('submit', () => localStorage.removeItem(DRAFT_KEY_NOTES_SHARED));
    document.addEventListener('DOMContentLoaded', loadSharedNoteDraft);
</script>
{% endblock %}