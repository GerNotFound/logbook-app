{% extends 'layout.html' %}
{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">LOGBOOK - SESSIONE PALESTRA</h1>
        <div class="d-flex justify-content-between align-items-center mb-3">
            <a href="{{ url_for('gym.sessione_palestra', date_param=prev_day) }}" class="btn btn-outline-light">◀ Prec.</a>
            <span class="text-center">
                <h5 class="mb-0 d-inline-block align-middle">{{ date_formatted }}</h5>
                {% if not is_today %}
                    <a href="{{ url_for('gym.sessione_palestra') }}" class="btn btn-sm btn-outline-secondary ms-2">Oggi</a>
                {% endif %}
            </span>
            <a href="{{ url_for('gym.sessione_palestra', date_param=next_day) }}" class="btn btn-outline-light {% if is_today %}disabled{% endif %}">Succ. ▶</a>
        </div>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
</div>

<div id="stopwatch-wrapper" class="stopwatch-wrapper">
    <div id="stopwatch-container" class="stopwatch-container">
        <div id="stopwatch" class="stopwatch-display">00:00</div>
        <button id="startBtn" type="button" class="btn btn-sm btn-circle ms-3">▶</button>
        <button id="pauseBtn" type="button" class="btn btn-sm btn-circle ms-2 fs-4">❚❚</button>
        <button id="stopBtn" type="button" class="btn btn-outline-light btn-sm btn-circle-outline ms-2">■</button>
    </div>
</div>

<div id="template-selection-box" class="mb-4 p-3 border rounded">
    <h5>Seleziona Scheda</h5>
    {% if templates %}
        <select id="template-selector" class="form-select form-control">
            <option value="">Nessuna scheda (allenamento libero)</option>
            {% for template in templates %}
                <option value="{{ template.id }}" {% if request.args.get('template_id')|int == template.id %}selected{% endif %}>{{ template.name }}</option>
            {% endfor %}
        </select>
    {% else %}
        <p class="text-muted">Nessuna scheda creata. Vai alla sezione apposita per iniziare.</p>
        <a href="{{ url_for('gym.scheda') }}" class="btn btn-custom w-100 d-block mt-2">VAI A SCHEDA</a>
    {% endif %}
</div>

<div id="workout-status-box" class="mb-4 p-3 border rounded d-none">
    <h5 id="status-template-name" class="mb-1"></h5>
    <p class="mb-0 text-muted">Durata: <span id="running-timer" class="fw-bold">00:00:00</span></p>
</div>


<form id="workout-form" method="POST" action="{{ url_for('gym.sessione_palestra', date_param=record_date, session_ts=session_timestamp if is_editing else None) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" id="template-name-input" name="template_name" value="">
    <input type="hidden" id="start-timestamp-input" name="start_timestamp">
    <div id="workout-section">
        <!-- Contenuto generato da JS -->
    </div>
</form>

<div class="sticky-bottom-nav">
    <!-- MODIFICA QUI: Aggiunto onclick con confirm per il salvataggio -->
    <button type="submit" form="workout-form" class="btn btn-custom action-btn" onclick="return confirm('Sei sicuro di voler salvare la sessione?')">
        SALVA
    </button>
    <a href="{{ url_for('gym.palestra') }}" id="cancel-workout-btn" class="btn btn-custom action-btn">ANNULLA</a>
</div>
{% endblock %}

{% block scripts %}
<script nonce="{{ csp_nonce() }}">
    (() => {
        const templatesData = {{ templates|tojson|safe }} || [];
        const logData = {{ log_data|tojson|safe }} || {};
        const currentUserId = {{ session['user_id']|tojson }};
        const recordDate = {{ record_date|tojson }};
        const sessionTimestamp = {{ session_timestamp|tojson }};
        const draftKeyBase = `workout_draft_${currentUserId}_${recordDate}`;
        const DRAFT_KEY = sessionTimestamp ? `${draftKeyBase}_${sessionTimestamp}` : draftKeyBase;

        const canUseLocalStorage = (() => {
            if (typeof window === 'undefined' || !window.localStorage) {
                return false;
            }
            try {
                const testKey = '__logbook_test__';
                window.localStorage.setItem(testKey, '1');
                window.localStorage.removeItem(testKey);
                return true;
            } catch (error) {
                console.warn('LocalStorage non disponibile', error);
                return false;
            }
        })();

        const createStorageHelper = (key, enabled) => ({
            load() {
                if (!enabled) {
                    return null;
                }
                try {
                    const rawDraft = window.localStorage.getItem(key);
                    return rawDraft ? JSON.parse(rawDraft) : null;
                } catch (error) {
                    console.warn("Impossibile leggere la bozza dell'allenamento", error);
                    return null;
                }
            },
            save(draft) {
                if (!enabled) {
                    return;
                }
                try {
                    window.localStorage.setItem(key, JSON.stringify(draft));
                } catch (error) {
                    console.warn("Impossibile salvare la bozza dell'allenamento", error);
                }
            },
            clear() {
                if (!enabled) {
                    return;
                }
                try {
                    window.localStorage.removeItem(key);
                } catch (error) {
                    console.warn("Impossibile cancellare la bozza dell'allenamento", error);
                }
            },
        });

        const storageHelper = createStorageHelper(DRAFT_KEY, canUseLocalStorage);

        const escapeHtml = (value) => {
            return (value ?? '')
                .toString()
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        };

        class Stopwatch {
            constructor(display, startBtn, pauseBtn, stopBtn) {
                this.display = display;
                this.startBtn = startBtn;
                this.pauseBtn = pauseBtn;
                this.stopBtn = stopBtn;

                this.isRunning = false;
                this.elapsedMs = 0;
                this.startedAt = null;
                this.interval = null;

                this.handleStart = this.start.bind(this);
                this.handlePause = this.pause.bind(this);
                this.handleStop = this.stop.bind(this);

                this.bindEvents();
                this.updateDisplay(0);
            }

            bindEvents() {
                if (this.startBtn) {
                    this.startBtn.addEventListener('click', this.handleStart);
                }
                if (this.pauseBtn) {
                    this.pauseBtn.addEventListener('click', this.handlePause);
                    this.pauseBtn.disabled = true;
                }
                if (this.stopBtn) {
                    this.stopBtn.addEventListener('click', this.handleStop);
                }
                if (typeof document !== 'undefined') {
                    document.addEventListener('visibilitychange', () => {
                        if (!document.hidden) {
                            this.refresh();
                        }
                    });
                }
            }

            start() {
                if (this.isRunning) {
                    return;
                }
                this.isRunning = true;
                this.startedAt = Date.now();
                this.interval = window.setInterval(() => this.refresh(), 1000);
                this.refresh();
                this.updateButtons();
            }

            pause() {
                if (!this.isRunning) {
                    return;
                }
                this.elapsedMs += Date.now() - (this.startedAt || Date.now());
                this.isRunning = false;
                this.startedAt = null;
                this.clearInterval();
                this.refresh();
                this.updateButtons();
            }

            stop() {
                this.isRunning = false;
                this.elapsedMs = 0;
                this.startedAt = null;
                this.clearInterval();
                this.updateDisplay(0);
                this.updateButtons(true);
            }

            refresh() {
                if (!this.display) {
                    return;
                }
                let totalMs = this.elapsedMs;
                if (this.isRunning && this.startedAt) {
                    totalMs += Date.now() - this.startedAt;
                }
                const totalSeconds = Math.max(0, Math.floor(totalMs / 1000));
                this.updateDisplay(totalSeconds);
            }

            updateDisplay(totalSeconds) {
                if (!this.display) {
                    return;
                }
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const minsString = minutes.toString().padStart(2, '0');
                const secsString = seconds.toString().padStart(2, '0');
                this.display.textContent = `${minsString}:${secsString}`;
            }

            updateButtons(reset = false) {
                if (this.startBtn) {
                    this.startBtn.disabled = this.isRunning;
                }
                if (this.pauseBtn) {
                    this.pauseBtn.disabled = reset ? true : !this.isRunning;
                }
            }

            clearInterval() {
                if (this.interval) {
                    window.clearInterval(this.interval);
                    this.interval = null;
                }
            }
        }

        class WorkoutSessionPage {
            constructor(options) {
                this.templatesData = Array.isArray(options.templatesData) ? options.templatesData : [];
                this.logData = options.logData || {};
                this.elements = options.elements || {};
                this.storage = options.storage;
                this.canUseStorage = options.canUseStorage;

                this.currentTemplateId = '';
                this.durationTimer = null;
                this.draft = { startTime: Date.now(), selectedTemplateId: '', fields: {} };
                this._startTime = Date.now();

                this.handleFieldInput = this.onFieldInput.bind(this);
                this.handleVisibilityChange = this.onVisibilityChange.bind(this);
            }

            init() {
                if (!this.elements.workoutSection) {
                    return;
                }

                this.stopwatch = new Stopwatch(
                    this.elements.stopwatchDisplay,
                    this.elements.stopwatchStartBtn,
                    this.elements.stopwatchPauseBtn,
                    this.elements.stopwatchStopBtn,
                );

                this.loadDraft();

                this.currentTemplateId =
                    this.draft.selectedTemplateId ||
                    (this.elements.templateSelector ? this.elements.templateSelector.value : '');

                if (this.elements.templateSelector && this.currentTemplateId) {
                    this.elements.templateSelector.value = this.currentTemplateId;
                }

                this.renderWorkout(this.currentTemplateId);
                this.updateUIForTemplateSelection(this.currentTemplateId);

                if (this.elements.templateSelector) {
                    this.elements.templateSelector.addEventListener('change', (event) => {
                        this.handleTemplateChange(event.target.value);
                    });
                }

                if (this.elements.workoutForm) {
                    this.elements.workoutForm.addEventListener('submit', () => this.handleSubmit());
                    this.elements.workoutForm.addEventListener('keydown', (event) => this.handleEnterNavigation(event));
                }

                if (this.elements.cancelButton) {
                    this.elements.cancelButton.addEventListener('click', (event) => this.handleCancel(event));
                }

                this.setupStopwatchSticky();

                if (typeof document !== 'undefined') {
                    document.addEventListener('visibilitychange', this.handleVisibilityChange);
                }

                if (this.currentTemplateId) {
                    this.persistDraft();
                }
            }

            get startTime() {
                return this._startTime;
            }

            set startTime(value) {
                this._startTime = value;
                if (this.elements.startTimestampInput) {
                    this.elements.startTimestampInput.value = value ? String(value) : '';
                }
            }

            loadDraft() {
                const storedDraft = this.storage ? this.storage.load() : null;
                const now = Date.now();
                this.draft = {
                    startTime: storedDraft?.startTime || now,
                    selectedTemplateId: storedDraft?.selectedTemplateId || '',
                    fields: storedDraft?.fields || {},
                };
                this.startTime = this.draft.startTime;
            }

            handleTemplateChange(templateId) {
                this.currentTemplateId = templateId || '';
                this.draft.selectedTemplateId = this.currentTemplateId;
                this.draft.fields = {};
                const newStartTime = Date.now();
                this.draft.startTime = newStartTime;
                this.startTime = newStartTime;

                this.renderWorkout(this.currentTemplateId);
                this.updateUIForTemplateSelection(this.currentTemplateId);
                this.persistDraft();
            }

            handleSubmit() {
                this.clearDraft();
            }

            handleEnterNavigation(event) {
                if (event.key !== 'Enter' && event.keyCode !== 13) {
                    return;
                }
                const currentInput = event.target;
                if (!currentInput || currentInput.tagName.toLowerCase() !== 'input') {
                    return;
                }
                event.preventDefault();
                const inputs = Array.from(
                    this.elements.workoutSection.querySelectorAll('input:not([disabled])'),
                );
                const currentIndex = inputs.indexOf(currentInput);
                if (currentIndex === -1) {
                    return;
                }
                const nextInput = inputs[currentIndex + 1];
                if (nextInput) {
                    nextInput.focus();
                    if (typeof nextInput.select === 'function') {
                        nextInput.select();
                    }
                } else {
                    currentInput.blur();
                }
            }

            handleCancel(event) {
                if (!window.confirm('Sei sicuro di voler annullare la sessione? I dati non salvati andranno persi.')) {
                    event.preventDefault();
                    return;
                }
                this.clearDraft({ resetState: true });
            }

            onFieldInput(event) {
                const field = event.target;
                if (!field || !field.name) {
                    return;
                }
                if (!this.draft.fields) {
                    this.draft.fields = {};
                }
                const value = field.value;
                if (value && value.trim() !== '') {
                    this.draft.fields[field.name] = value;
                } else {
                    delete this.draft.fields[field.name];
                }
                this.persistDraft();
            }

            attachInputListeners() {
                const fields = this.elements.workoutSection.querySelectorAll('input, textarea');
                fields.forEach((field) => {
                    field.removeEventListener('input', this.handleFieldInput);
                    field.addEventListener('input', this.handleFieldInput);
                });
            }

            renderWorkout(templateId) {
                const section = this.elements.workoutSection;
                if (!section) {
                    return;
                }
                section.innerHTML = '';
                const draftFields = this.draft.fields || {};
                const sessionLogData = this.logData || {};

                if (!templateId) {
                    this.currentTemplateId = '';
                    this.draft.selectedTemplateId = '';
                    this.templateName = 'Allenamento Libero';
                    this.persistDraft();
                    this.attachInputListeners();
                    return;
                }

                const selectedTemplate = this.templatesData.find(
                    (tpl) => String(tpl.id) === String(templateId),
                );

                if (!selectedTemplate) {
                    this.currentTemplateId = '';
                    this.draft.selectedTemplateId = '';
                    this.templateName = 'Allenamento Libero';
                    this.persistDraft();
                    this.attachInputListeners();
                    return;
                }

                this.currentTemplateId = templateId;
                this.draft.selectedTemplateId = templateId;
                this.templateName = selectedTemplate.name || 'Allenamento Libero';

                const fragment = document.createDocumentFragment();

                selectedTemplate.exercises.forEach((exercise) => {
                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = this.buildExerciseHtml(exercise, draftFields, sessionLogData);
                    while (wrapper.firstChild) {
                        fragment.appendChild(wrapper.firstChild);
                    }
                });

                section.appendChild(fragment);
                this.attachInputListeners();
            }

            buildExerciseHtml(exercise, draftFields, sessionLogData) {
                const parentId = `exercise-group-${exercise.id}`;
                const commentsId = `comments-${exercise.id}`;
                const notesId = `notes-${exercise.id}`;
                const historyId = `history-${exercise.id}`;
                const commentBoxId = `comment-box-${exercise.id}`;

                const lastCommentText = exercise.last_comment
                    ? `<strong>${escapeHtml(exercise.last_comment_date || '')}:</strong> ${escapeHtml(exercise.last_comment)}`
                    : 'Nessun commento precedente.';
                const commentsHtml = `<div id="${commentsId}" class="collapse" data-bs-parent="#${parentId}"><div class="card card-body mt-2 text-sm">${lastCommentText}</div></div>`;

                const notesHtml = exercise.notes
                    ? `<div id="${notesId}" class="collapse" data-bs-parent="#${parentId}"><div class="card card-body mt-2 text-sm text-prewrap">${escapeHtml(exercise.notes)}</div></div>`
                    : '';

                let historyContent = '<small class="text-muted">Nessuno storico precedente.</small>';
                if (Array.isArray(exercise.history) && exercise.history.length > 0) {
                    historyContent = exercise.history
                        .map((session) => {
                            const setsText = Array.isArray(session.sets)
                                ? session.sets.map((item) => escapeHtml(item)).join(' - ')
                                : '';
                            return `<div class="mb-1"><small><strong>${escapeHtml(session.date_formatted || '')}:</strong> ${setsText}</small></div>`;
                        })
                        .join('');
                }
                const historyHtml = `<div id="${historyId}" class="collapse" data-bs-parent="#${parentId}"><div class="card card-body mt-2 text-sm">${historyContent}</div></div>`;

                const draftCommentKey = `comment_${exercise.exercise_id}`;
                const existingComment =
                    draftFields[draftCommentKey] ?? sessionLogData[draftCommentKey] ?? '';

                const commentBoxHtml = `<div id="${commentBoxId}" class="collapse mt-2" data-bs-parent="#${parentId}"><textarea name="comment_${exercise.exercise_id}" class="form-control form-control-sm" rows="2" placeholder="Aggiungi un commento...">${escapeHtml(existingComment)}</textarea></div>`;

                const commentsButtonHtml = `<button type="button" class="btn btn-sm btn-outline-secondary btn-compact" data-bs-toggle="collapse" data-bs-target="#${commentsId}">Commenti</button>`;
                const notesButtonHtml = exercise.notes
                    ? `<button type="button" class="btn btn-sm btn-outline-secondary btn-compact" data-bs-toggle="collapse" data-bs-target="#${notesId}">Note</button>`
                    : '';
                const historyButtonHtml = `<button type="button" class="btn btn-sm btn-outline-secondary btn-compact" data-bs-toggle="collapse" data-bs-target="#${historyId}">Storico</button>`;

                const totalSets = Number.parseInt(exercise.sets, 10) || 0;
                const setsHtml = Array.from({ length: totalSets }, (_, index) => {
                    const setNumber = index + 1;
                    const logKey = `${exercise.exercise_id}_${setNumber}`;
                    const draftWeightKey = `weight_${exercise.exercise_id}_${setNumber}`;
                    const draftRepsKey = `reps_${exercise.exercise_id}_${setNumber}`;
                    const logEntry = sessionLogData[logKey] || {};

                    const weightValue =
                        draftFields[draftWeightKey] ?? logEntry.weight ?? '';
                    const repsValue =
                        draftFields[draftRepsKey] ?? logEntry.reps ?? '';

                    return `
                        <div class="row g-2 align-items-center mb-2">
                            <div class="col-2 text-center"><span class="badge bg-secondary">Set ${setNumber}</span></div>
                            <div class="col-5"><input type="text" name="weight_${exercise.exercise_id}_${setNumber}" class="form-control form-control-sm" placeholder="Peso (kg)" value="${escapeHtml(weightValue)}"></div>
                            <div class="col-5"><input type="number" min="0" step="1" name="reps_${exercise.exercise_id}_${setNumber}" class="form-control form-control-sm" placeholder="Reps" value="${escapeHtml(repsValue)}"></div>
                        </div>`;
                }).join('');

                return `
                    <div class="mb-3 p-3 border rounded" id="${parentId}">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5>${escapeHtml(exercise.name)}</h5>
                            <div class="btn-group">${commentsButtonHtml}${notesButtonHtml}${historyButtonHtml}</div>
                        </div>
                        ${commentsHtml}${notesHtml}${historyHtml}
                        <hr class="my-2">
                        ${setsHtml}
                        <div class="mt-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary btn-compact" data-bs-toggle="collapse" data-bs-target="#${commentBoxId}">+ Commento</button>
                        </div>
                        ${commentBoxHtml}
                    </div>`;
            }

            set templateName(value) {
                if (this.elements.templateNameInput) {
                    this.elements.templateNameInput.value = value || '';
                }
            }

            updateUIForTemplateSelection(templateId) {
                const hasTemplate = Boolean(templateId);
                if (this.elements.templateSelectionBox) {
                    this.elements.templateSelectionBox.classList.toggle('d-none', hasTemplate);
                }
                if (this.elements.workoutStatusBox) {
                    this.elements.workoutStatusBox.classList.toggle('d-none', !hasTemplate);
                }
                if (hasTemplate) {
                    const selectedTemplate = this.templatesData.find(
                        (tpl) => String(tpl.id) === String(templateId),
                    );
                    if (this.elements.statusTemplateName) {
                        this.elements.statusTemplateName.textContent = selectedTemplate
                            ? selectedTemplate.name
                            : '';
                    }
                    this.startDurationTimer(this.startTime);
                } else {
                    if (this.elements.statusTemplateName) {
                        this.elements.statusTemplateName.textContent = '';
                    }
                    this.stopDurationTimer();
                }
            }

            startDurationTimer(startTimeMs) {
                this.stopDurationTimer();
                if (!this.elements.runningTimer || !startTimeMs) {
                    return;
                }
                const update = () => {
                    const elapsedSeconds = Math.max(0, Math.floor((Date.now() - startTimeMs) / 1000));
                    this.elements.runningTimer.textContent = this.formatDuration(elapsedSeconds);
                };
                update();
                this.durationTimer = window.setInterval(update, 1000);
            }

            stopDurationTimer() {
                if (this.durationTimer) {
                    window.clearInterval(this.durationTimer);
                    this.durationTimer = null;
                }
                if (this.elements.runningTimer) {
                    this.elements.runningTimer.textContent = '00:00:00';
                }
            }

            formatDuration(totalSeconds) {
                const hours = Math.floor(totalSeconds / 3600)
                    .toString()
                    .padStart(2, '0');
                const minutes = Math.floor((totalSeconds % 3600) / 60)
                    .toString()
                    .padStart(2, '0');
                const seconds = Math.floor(totalSeconds % 60)
                    .toString()
                    .padStart(2, '0');
                return `${hours}:${minutes}:${seconds}`;
            }

            updateDurationDisplay() {
                if (!this.currentTemplateId || !this.elements.runningTimer) {
                    return;
                }
                const elapsedSeconds = Math.max(0, Math.floor((Date.now() - this.startTime) / 1000));
                this.elements.runningTimer.textContent = this.formatDuration(elapsedSeconds);
            }

            persistDraft() {
                if (!this.storage) {
                    return;
                }
                const fields = this.draft.fields || {};
                const hasFields = Object.values(fields).some(
                    (value) => value && value.toString().trim() !== '',
                );
                if (!hasFields && !this.currentTemplateId) {
                    this.storage.clear();
                    return;
                }
                this.storage.save({
                    startTime: this.startTime,
                    selectedTemplateId: this.currentTemplateId,
                    fields: { ...fields },
                });
            }

            clearDraft({ resetState = false } = {}) {
                if (this.storage) {
                    this.storage.clear();
                }
                if (resetState) {
                    this.draft = { startTime: Date.now(), selectedTemplateId: '', fields: {} };
                    this.currentTemplateId = '';
                }
            }

            setupStopwatchSticky() {
                const wrapper = this.elements.stopwatchWrapper;
                const container = this.elements.stopwatchContainer;
                if (!wrapper || !container) {
                    return;
                }
                const wrapperHeight = wrapper.offsetHeight;
                if (wrapperHeight > 0) {
                    wrapper.style.minHeight = `${wrapperHeight}px`;
                }
                window.addEventListener('scroll', () => {
                    if (wrapper.getBoundingClientRect().top <= 0) {
                        container.classList.add('stopwatch-sticky');
                    } else {
                        container.classList.remove('stopwatch-sticky');
                    }
                });
            }

            onVisibilityChange() {
                if (document.hidden) {
                    return;
                }
                this.updateDurationDisplay();
                if (this.stopwatch) {
                    this.stopwatch.refresh();
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const page = new WorkoutSessionPage({
                templatesData,
                logData,
                canUseStorage: canUseLocalStorage,
                storage: storageHelper,
                elements: {
                    templateSelector: document.getElementById('template-selector'),
                    workoutSection: document.getElementById('workout-section'),
                    templateNameInput: document.getElementById('template-name-input'),
                    startTimestampInput: document.getElementById('start-timestamp-input'),
                    workoutForm: document.getElementById('workout-form'),
                    templateSelectionBox: document.getElementById('template-selection-box'),
                    workoutStatusBox: document.getElementById('workout-status-box'),
                    statusTemplateName: document.getElementById('status-template-name'),
                    runningTimer: document.getElementById('running-timer'),
                    cancelButton: document.getElementById('cancel-workout-btn'),
                    stopwatchDisplay: document.getElementById('stopwatch'),
                    stopwatchStartBtn: document.getElementById('startBtn'),
                    stopwatchPauseBtn: document.getElementById('pauseBtn'),
                    stopwatchStopBtn: document.getElementById('stopBtn'),
                    stopwatchWrapper: document.getElementById('stopwatch-wrapper'),
                    stopwatchContainer: document.getElementById('stopwatch-container'),
                },
            });
            page.init();
        });
    })();
</script>

{% endblock %}
